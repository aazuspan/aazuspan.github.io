<!DOCTYPE html>
<html lang="en">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Cellular Flood</title>

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/github.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <script src="https://kit.fontawesome.com/4a17c01cce.js" crossorigin="anonymous"></script>
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Let’s simulate sea level rise with cellular automata in Earth Engine.">

        <meta name="author" content="Aaron Zuspan">

        <meta name="tags" content="earth-engine">
        <meta name="tags" content="cellular-automata">
        <meta name="tags" content="javascript">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Aaron Zuspan">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/aaron-zuspan.html">
	<meta property="og:url" content="/cellular-flood.html">
	<meta property="og:title" content="Cellular Flood">
	<meta property="article:published_time" content="2022-08-07 00:00:00-07:00">
            <meta property="og:description" content="Let’s simulate sea level rise with cellular automata in Earth Engine.">

            <meta property="og:image" content="/assets/clouds.jpeg">
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@aazuspan">
        <meta name="twitter:title" content="Cellular Flood">

            <meta name="twitter:image" content="/assets/clouds.jpeg">

            <meta name="twitter:description" content="Let’s simulate sea level rise with cellular automata in Earth Engine.">
</head>

<body class="article-cellular-flood">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Aaron Zuspan</a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                            <li><a href="/pages/about.html">About</a></li>
                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/assets/clouds.jpeg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Cellular Flood</h1>
                        <span class="meta">Posted by
                                <a href="/author/aaron-zuspan.html">Aaron Zuspan</a>
                             on 2022.08.07
                        </span>
                            <span class="meta">Updated on 2022.11.27</span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p>I recently built <a href="https://aazuspan.github.io/cellular-automata-in-earth-engine.html">Conway&#8217;s Game of Life in Earth Engine</a>. It was a fun experiment, but I felt like it ignored one of the coolest aspects of cellular automata in Earth Engine—easy access to petabytes of geospatial data. So I decided to build a cellular automaton that would use elevation data to roughly simulate changes in sea&nbsp;level.</p>
<p><center><img src="./assets/olympic.gif" alt="Simulated sea level rise in the Pacific Northwest"></img></center></p>
<p>If you want to run it yourself, check out the <a href="https://aazuspan.users.earthengine.app/view/cellular-flood">Earth Engine app</a>. Below, I&#8217;ll go through the code to show how it&nbsp;works.</p>
<h2>Cellular&nbsp;Automata</h2>
<p>As I outlined in the <a href="https://aazuspan.github.io/cellular-automata-in-earth-engine.html">Game of Life post</a>, cellular automata operate in three&nbsp;steps:</p>
<ol>
<li>Set each cell to an initial state, usually&nbsp;randomly.</li>
<li>Determine the next state for each cell based on its current state, the states of the cells around it, and a fixed set of&nbsp;rules.</li>
<li>Set each cell to its new state. Repeat steps 2 and&nbsp;3.</li>
</ol>
<h2>The Initial&nbsp;State</h2>
<p>To simulate sea level change, each cell was assigned as above or below water, represented by pixel values of 0 or 1. I wanted to use current oceans as the starting point, so I decided to start with global land cover data from the <a href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_Landcover_100m_Proba-V-C3_Global">Copernicus Global Land Cover</a>&nbsp;dataset.</p>
<p>Below, I loaded the <span class="caps">LULC</span> data, reprojected to a coarse scale to speed up processing, and created a binary mask from pixels classified as oceans and seas (value&nbsp;200).</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">proj</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Projection</span><span class="p">(</span><span class="s2">&quot;EPSG:3857&quot;</span><span class="p">).</span><span class="nx">atScale</span><span class="p">(</span><span class="mf">1800</span><span class="p">);</span><span class="w"></span>
<span class="kd">var</span><span class="w"> </span><span class="nx">cgls</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="s2">&quot;COPERNICUS/Landcover/100m/Proba-V-C3/Global&quot;</span><span class="p">);</span><span class="w"></span>

<span class="kd">var</span><span class="w"> </span><span class="nx">ocean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">cgls</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">first</span><span class="p">()</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;discrete_classification&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mf">200</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">unmask</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">updateMask</span><span class="p">(</span><span class="mf">1</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">reproject</span><span class="p">(</span><span class="nx">proj</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p><center><img src="./assets/cellular_flood_oceans.png" alt="A binary mask of global oceans"></img></center></p>
<p>At this point, I also initialized the starting sea level and loaded the elevation data that would be used to update cell states. I decided to use the <a href="https://developers.google.com/earth-engine/datasets/catalog/NOAA_NGDC_ETOPO1"><span class="caps">ETOPO1</span> global elevation</a> dataset because it included bathymetry data that allowed me to both raise <em>and</em> lower sea level, exposing underwater&nbsp;terrain. </p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">seaLevel</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0</span><span class="p">;</span><span class="w"></span>

<span class="kd">var</span><span class="w"> </span><span class="nx">elevation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Image</span><span class="p">(</span><span class="s2">&quot;NOAA/NGDC/ETOPO1&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;bedrock&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">resample</span><span class="p">(</span><span class="s2">&quot;bilinear&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="p">.</span><span class="nx">reproject</span><span class="p">(</span><span class="nx">proj</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<h2>The Next&nbsp;State</h2>
<p>After establishing the initial state, the next step was to figure out how to update that state with a new sea level. There&#8217;s a lot of research on using cellular automata to accurately simulate flooding and inundation with complex rules that take fluid dynamics and physics into account, but my goal was just to create a fun tech demo, so I came up with the simplest ruleset I could think&nbsp;of.</p>
<p>Each time step, sea level is changed by a fixed amount and cells adjacent to water become water <em>if</em> their elevation is below the current sea&nbsp;level. </p>
<p>I found pixels adjacent to water by running a max reducer over neighborhoods of pixels. Because water cells have a value of 1 and land cells have a value of 0, the max reducer would locate any land cells near to water. I settled on a circular kernel with a radius of 3 after some experimentation, as smaller kernels produced less realistic flooding behavior and larger kernels took too long to&nbsp;process.</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">adjacent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ocean</span><span class="p">.</span><span class="nx">reduceNeighborhood</span><span class="p">({</span><span class="w"></span>
<span class="w">    </span><span class="nx">reducer</span><span class="o">:</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">max</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="nx">kernel</span><span class="o">:</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Kernel</span><span class="p">.</span><span class="nx">circle</span><span class="p">(</span><span class="mf">3</span><span class="p">),</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>
</code></pre></div>

<p>Finally, I incremented the sea level by an adjustable rate of change and compared the elevation of the adjacent pixels to the updated sea level, generating the next binary ocean&nbsp;mask.</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">rate</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span><span class="w"></span>

<span class="nx">seaLevel</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="nx">rate</span><span class="p">;</span><span class="w"></span>
<span class="nx">ocean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adjacent</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">and</span><span class="p">(</span><span class="nx">elevation</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="nx">seaLevel</span><span class="p">));</span><span class="w"></span>
</code></pre></div>

<p><center><img src="./assets/cellular_flood_step.gif" alt="A binary ocean mask in the U.S. Gulf Coast before and after updating sea level."></img></center></p>
<h2>Rinse and&nbsp;Repeat</h2>
<p>With the logic for changing sea level and expanding water into new areas written, the next step was simply to repeat that process, storing each state in an array to show how water extent would change over&nbsp;time.</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">states</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="nx">ocean</span><span class="p">];</span><span class="w"></span>

<span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kd">var</span><span class="w"> </span><span class="nx">i</span><span class="o">=</span><span class="mf">0</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">&lt;</span><span class="mf">10</span><span class="p">;</span><span class="w"> </span><span class="nx">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kd">var</span><span class="w"> </span><span class="nx">adjacent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ocean</span><span class="p">.</span><span class="nx">reduceNeighborhood</span><span class="p">({</span><span class="w"></span>
<span class="w">    </span><span class="nx">reducer</span><span class="o">:</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Reducer</span><span class="p">.</span><span class="nx">max</span><span class="p">(),</span><span class="w"></span>
<span class="w">    </span><span class="nx">kernel</span><span class="o">:</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">Kernel</span><span class="p">.</span><span class="nx">circle</span><span class="p">(</span><span class="mf">3</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="p">});</span><span class="w"></span>

<span class="w">  </span><span class="nx">seaLevel</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mf">5</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="nx">ocean</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">adjacent</span><span class="p">.</span><span class="nx">eq</span><span class="p">(</span><span class="mf">1</span><span class="p">).</span><span class="nx">and</span><span class="p">(</span><span class="nx">elevation</span><span class="p">.</span><span class="nx">lt</span><span class="p">(</span><span class="nx">seaLevel</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="nx">states</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ocean</span><span class="p">);</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>

<p>While you could simply add each state to the map to see the changes, I decided to combine then into an image collection for&nbsp;animation.</p>
<div class="highlight"><pre><span></span><code><span class="kd">var</span><span class="w"> </span><span class="nx">params</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nx">region</span><span class="o">:</span><span class="w"> </span><span class="nx">geometry</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">crs</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;EPSG:3857&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">dimensions</span><span class="o">:</span><span class="w"> </span><span class="mf">350</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">format</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;gif&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nx">framesPerSecond</span><span class="o">:</span><span class="w"> </span><span class="mf">8</span><span class="p">,</span><span class="w"></span>
<span class="p">};</span><span class="w"></span>

<span class="kd">var</span><span class="w"> </span><span class="nx">anim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">ui</span><span class="p">.</span><span class="nx">Thumbnail</span><span class="p">({</span><span class="w"></span>
<span class="w">  </span><span class="nx">image</span><span class="o">:</span><span class="w"> </span><span class="nx">ee</span><span class="p">.</span><span class="nx">ImageCollection</span><span class="p">(</span><span class="nx">states</span><span class="p">),</span><span class="w"></span>
<span class="w">  </span><span class="nx">params</span><span class="o">:</span><span class="w"> </span><span class="nx">params</span><span class="p">,</span><span class="w"></span>
<span class="p">});</span><span class="w"></span>

<span class="nx">print</span><span class="p">(</span><span class="nx">anim</span><span class="p">);</span><span class="w"></span>
</code></pre></div>

<p>Here&#8217;s the result, showing 50 time steps with +1m of sea level change per step over the Gulf&nbsp;Coast.</p>
<p><center><img src="./assets/cellular_flood_gulf_coast.gif" alt="An animation of a binary ocean mask in the U.S. Gulf Coast spreading over land."></img></center></p>
<h2>Polishing and&nbsp;Packaging</h2>
<p>With the core cellular automaton built, I spent a while tweaking the visualization to make it more visually impressive. I won&#8217;t go into all the details, but I used the ocean mask and elevation data to color water based on depth, blended that over a hillshade, and overlayed a settlement layer on top to give some spatial context. You can check out the <a href="https://code.earthengine.google.com/cefc8aa7e2c4afc4f7d3cfb85103466d">final code here</a>, which also includes the <span class="caps">UI</span> elements for the&nbsp;app.</p>
<p><center><img src="./assets/gibraltar.gif" alt="Simulated sea level rise in the Strait of Gibraltar"></img></center></p>
    </article>

        <div class="tags">
            <p>tags: <a href="/tag/earth-engine.html">earth-engine</a>, <a href="/tag/cellular-automata.html">cellular-automata</a>, <a href="/tag/javascript.html">javascript</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://twitter.com/aazuspan" title="twitter">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/aazuspan" title="github">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://fosstodon.org/@aazuspan" title="mastodon">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-mastodon fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog powered by <a href="http://getpelican.com">Pelican</a>,
    which takes great advantage of <a href="http://python.org">Python</a>. <br />        &copy;  Aaron Zuspan
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

<script type="text/javascript">
    var disqus_shortname = 'https-aazuspan-github-io';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>

</html>